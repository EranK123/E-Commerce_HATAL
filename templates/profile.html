{% extends "base.html" %}
{% block content %}
  <h2>Profile</h2>

  <p>Welcome, {{ user.username }}!</p>
  <p>Email: {{ user.email }}</p>
  <a href="{{ url_for('logout') }}">Logout</a>

  <h3>Search for Items by Category</h3>

  <form method="post" action="{{ url_for('profile') }}">
    {{ form.hidden_tag() }}
    {{ form.category.label }}
    {{ form.category(size=32) }}
    {{ form.submit_search() }}
  </form>

  {% if search_results %}
  <h3>Search Results</h3>
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% for category, message in messages %}
      {% if category == 'success' %}
        <div class="alert alert-success">
          {{ message }}
        </div>
      {% endif %}
    {% endfor %}
  {% endwith %}
  <ul>
    {% for product in search_results %}
      <li>
        <strong>{{ product.name }}</strong>: {{ product.description }} - ${{ product.price }}
        {% if product %}
          <form method="post" action="{{ url_for('profile') }}">
            {{ order_form.hidden_tag() }}
            <input type="hidden" name="product_id" value="{{ product.id }}">
            <button type="submit">Order</button>
          </form>
        {% endif %}
      </li>
    {% endfor %}
  </ul>
{% endif %}

{% endblock %}
